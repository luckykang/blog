---
layout: post
title: 2022-06-11-玩转NAS系列01丨FRP内网穿透的设置
tag: NAS
---
# 一.FRP介绍

frp是一个高性能的反向代理应用，可以轻松地进行内网穿透，对外网提供服务，支持tcp, udp,http, https等协议类型，并且web服务支持根据域名进行路由转发。

frp内网穿透主要用于没有公网IP的用户，实现远程桌面、远程控制路由器、搭建的WEB、FTP、SMB服务器被外网访问、远程查看摄像头、调试一些远程的API（比如微信公众号，企业号的开发）等。

# 二.前期准备

购买云服务器的目的，就是为了可以拥有公网IP，这样当我们在家外需要连接家里的nas的时候，就可以通过云服务器的公网IP访问家里的内网设备。

## 1.创建实例

创建实例的时候建议选择centos系统作为实例进行安装，我这里使用的是centos7.6。创建成功实例后就可以获取到公网IP。

![20220612175422](https://cdn.jsdelivr.net/gh/luckykang/picture_bed/blogs_images/20220612175422.png)

## 2.在控制台创建秘钥对

腾讯云服务是需要证书认证的，所以需要创建新的秘钥对。

![20220611160942](https://cdn.jsdelivr.net/gh/luckykang/picture_bed/blogs_images/20220611160942.png)

创建完成后，会下载私钥，私钥需要保存好，一会远程登录会用。

![20220611161151](https://cdn.jsdelivr.net/gh/luckykang/picture_bed/blogs_images/20220611161151.png)

## 3.绑定秘钥到实例

点击 `绑定/解绑实例`
![20220611163012](https://cdn.jsdelivr.net/gh/luckykang/picture_bed/blogs_images/20220611163012.png)

在跳转页面点击 `绑定秘钥对`

![20220611163247](https://cdn.jsdelivr.net/gh/luckykang/picture_bed/blogs_images/20220611163247.png)

勾选该秘钥

![20220611163336](https://cdn.jsdelivr.net/gh/luckykang/picture_bed/blogs_images/20220611163336.png)

点击下一步，然后确定。这里系统提示要关机。

![20220611163422](https://cdn.jsdelivr.net/gh/luckykang/picture_bed/blogs_images/20220611163422.png)

这时已看到绑定成功

![20220611163542](https://cdn.jsdelivr.net/gh/luckykang/picture_bed/blogs_images/20220611163542.png)

## 4.finalshell访问服务器的设置

认证方式选择`公钥`,用户名为`root`,私钥点击浏览，选择之前生成的文件。

![20220612183425](https://cdn.jsdelivr.net/gh/luckykang/picture_bed/blogs_images/20220612183425.png)

可以看到连接成功了

![20220612183923](https://cdn.jsdelivr.net/gh/luckykang/picture_bed/blogs_images/20220612183923.png)

# 三.云服务器的frp配置

## 1.下载frp package

finalshell登录远程服务器，下载frp

```
wget https://github.com/fatedier/frp/releases/download/v0.43.0/frp_0.43.0_linux_amd64.tar.gz

tar -zxvf frp_0.43.0_linux_amd64.tar.gz

mv frp_0.43.0_linux_amd64 frp
```

## 2.配置frps.ini文件

服务器端使用的是frps.ini文件，打开并添加token,内容可以随意命名

```
[common]
bind_port = 7000
token = password2020
```

输入命令，启动frp。

```
./frps -c frps.ini
```

## 3.防火墙开放端口访问

我们需要按配置文件开放7000端口，我这里开放了6000-8000所有的端口。

![20220612185800](https://cdn.jsdelivr.net/gh/luckykang/picture_bed/blogs_images/20220612185800.png)

## 4.运行与设置开机自启

`ctrl+c`先停止服务,然后配置服务

```
vim /lib/systemd/system/frps.service
```
输入下面参数配置，需要注意的是`ExecStart`中的`frp`为实际解压文件名

```
[Unit]
Description=fraps service
After=network.target syslog.target
Wants=network.target

[Service]
Type=simple
ExecStart=/root/frp/frps -c /root/frp/frps.ini  

[Install]
WantedBy=multi-user.target

```
使配置开机自动生效

```
systemctl start frps

systemctl enable frps
```

重启后，使用 `ps auxw` 可以看到frps服务自启动成功。到这里服务器的设置就完成了。

![20220612194501](https://cdn.jsdelivr.net/gh/luckykang/picture_bed/blogs_images/20220612194501.png)

# 四.nas上的frs设置（docker部署）

## 1.x


``


# 参考：

doc:[https://gofrp.org/docs/](https://gofrp.org/docs/)

frp_download:[https://github.com/fatedier/frp](https://github.com/fatedier/frp)